const func=a=>{const b=a.split(" ");console.log(b.length),b.map((a,c)=>{const d=a.toString(),e=d.slice(1,-1);return null===document.getElementById(e)?null:void(b.splice(c,1),elementHandler(document.getElementById(e),b))})},elementHandler=(a,b)=>{switch(a.tagName){case"INPUT":a.focus(),a.className="form-control is-invalid",console.log("Focused");break;case"BUTTON":a.click(),console.log("Click"),newMap(b);break;case"TEXTAREA":a.focus(),console.log("Focused");break;default:}},newMap=a=>{a.map(a=>{document.getElementById(a)?console.log("Super",a):console.log("Pas super",a)})};var stepsList=[];if("undefined"==typeof jsonstring||null===jsonstring)var json={},steps={};else{if(console.log(typeof json),"object"==typeof jsonstring)var json=jsonstring;else{console.log(typeof jsonstring);var json=JSON.parse(jsonstring)}console.log(json);var steps=json.steps;document.getElementById("script_name").value=json.script_name,document.getElementById("summary").textContent=json.summary;var liste=document.getElementById("step_list"),stepsKeys=Object.keys(steps);stepsKeys.forEach(a=>{stepsList.push(a);var b=document.createElement("tr");b.setAttribute("name",a);var c=document.createElement("td");c.innerHTML=a,b.appendChild(c),liste.appendChild(b);var d=document.getElementById("first_step"),e=document.createElement("option");e.value=a,e.innerHTML=a,d.appendChild(e);var f=document.createElement("button");f.setAttribute("id",a),f.innerHTML="Modifier",f.className="btn btn-info",f.style.margin="0.5em",f.setAttribute("type","button"),f.setAttribute("data-toggle","modal"),f.setAttribute("data-target","#exampleModal"),b.appendChild(f),f.addEventListener("click",modifyButton);var g=document.createElement("button");g.setAttribute("id",a),g.innerHTML="Supprimer",g.className="btn btn-danger",g.style.margin="0.5em",b.appendChild(g),g.addEventListener("click",deleteBtn)})}function deleteBtn(){var a=this.id;delete steps[a];var b=document.getElementsByName(a)[0];b.parentNode.removeChild(b)}function modifyButton(){var a=this.id,b=steps[a];document.getElementById("step_name").value=a,document.getElementById("question").textContent=b.question,document.getElementById("answer1").textContent=b.answers[0].answer,!b.answers[0].return_message||(document.getElementById("return_message1").textContent=b.answers[0].return_message),b.answers[0].actions.forEach(a=>{"add_points"==a.action?document.getElementById("addpoints1").checked=!0:"endgame"==a.action?(document.getElementById("endgame1").checked=!0,!!a.value&&(document.getElementById("endgame_value1").textContent=a.value)):"rankup"==a.action&&(document.getElementById("rankup1").checked=!0,"gold"==a.value?document.getElementById("rankup_select1").getElementsByTagName("option")[0].selected=!0:"silver"==a.value?document.getElementById("rankup_select1").getElementsByTagName("option")[1].selected=!0:document.getElementById("rankup_select1").getElementsByTagName("option")[2].selected=!0,a.hasOwnProperty("message")&&(document.getElementById("rankup_value1").textContent=a.message))}),!b.answers[0].next_step||(document.getElementById("next_step1").value=b.answers[0].next_step),document.getElementById("answer2").textContent=b.answers[1].answer,!b.answers[1].return_message||(document.getElementById("return_message2").textContent=b.answers[1].return_message),b.answers[1].actions.forEach(a=>{"add_points"==a.action?document.getElementById("addpoints2").checked=!0:"endgame"==a.action?(document.getElementById("endgame2").checked=!0,!!a.value&&(document.getElementById("endgame_value2").textContent=a.value)):"rankup"==a.action&&(document.getElementById("rankup2").checked=!0,document.getElementById("rankup_select2").getElementsByTagName("option")[1].selected=!("gold"!=a.value)||!("silver"!=a.value)||!0,a.hasOwnProperty("message")&&(document.getElementById("rankup_value2").textContent=a.message))}),!b.answers[1].next_step||(document.getElementById("next_step2").value=b.answers[1].next_step)}function modify(){document.querySelectorAll("#step_list > tr").forEach(a=>{console.log(a)});var a=document.getElementById("step_name").value,b=document.getElementById("question").value,c=document.getElementById("answer1").value,d=document.getElementById("return_message1").value;""==d&&(d="null");var e=document.getElementById("next_step1").value;""==e&&(e="null");var f=[];if(document.getElementById("rankup1").checked){var g=document.getElementById("rankup_value1").value,h=document.getElementById("rankup_select1"),i=h.options[h.selectedIndex].value,j={action:"rankup",value:i,message:g};f.push(j)}var k=[];if(document.getElementById("endgame1").checked){var l=document.getElementById("endgame_value1").value;f.push({action:"end_game",value:l})}document.getElementById("addpoints1").checked&&f.push({action:"addpoints",value:"1"});var m=document.getElementById("answer2").value,n=document.getElementById("return_message2").value;""==n&&(n="s");var o=document.getElementById("next_step2").value;if(""==o&&(o="null"),document.getElementById("rankup2").checked){var p=document.getElementById("rankup_value2").value,h=document.getElementById("rankup_select2"),q=h.options[h.selectedIndex].value,j={action:"rankup",value:q,message:p};k.push(rankup2)}if(document.getElementById("endgame2").checked){var r=document.getElementById("endgame_value2").value;k.push({action:"end_game",value:r})}document.getElementById("addpoints2").checked&&k.push({action:"addpoints",value:"1"}),0===f.length&&f.push({action:"addpoints",value:"1"}),0===k.length&&k.push({action:"addpoints",value:"1"});var c={answer:c,return_message:d,actions:f,next_step:e},m={answer:m,return_message:n,actions:k,next_step:o},s={question:b,answers:[c,m],options:{}};a in steps||addStep(a),steps[a]=s,document.getElementsByClassName("step_form")[0].reset()}document.getElementsByClassName("step_form")[0].addEventListener("submit",modify);function handleSubmit(a){a.preventDefault();var b=document.getElementById("script_name").value,c=document.getElementById("summary").value,d=document.getElementById("first_step"),e=d.options[d.selectedIndex].text,f=document.getElementById("pack"),g=f.options[f.selectedIndex].id,h=document.getElementById("character_id"),i=h.options[h.selectedIndex].id;json={script_name:b,summary:c,version:1,script_background:"blabla.jpg",initial_step:e,character_id:i,pack:g,steps:steps};var j=document.createElement("form");j.setAttribute("method","post"),j.setAttribute("action","validate.php");var k=document.createElement("input");k.setAttribute("type","hidden"),k.setAttribute("name","json"),k.setAttribute("value",""),k.value=JSON.stringify(json),j.appendChild(k),document.getElementsByTagName("body")[0].appendChild(j),j.submit()}document.getElementById("submit").addEventListener("click",handleSubmit);var updateButton=document.getElementById("add_step_btn");updateButton.addEventListener("click",function(){});function addStep(a){var b=document.getElementById("step_list"),c=document.createElement("tr");c.setAttribute("name",a);var d=document.createElement("td");d.innerHTML=a,c.appendChild(d),b.appendChild(c);var e=document.getElementById("first_step"),f=document.createElement("option");f.value=a,f.innerHTML=a,e.appendChild(f);var g=document.createElement("button");g.setAttribute("id",a),g.innerHTML="Modifier",c.appendChild(g),g.addEventListener("click",modifyButton);var h=document.createElement("button");h.setAttribute("id",a),h.innerHTML="Supprimer",c.appendChild(h),h.addEventListener("click",deleteBtn)}function saveDraft(){}const watch=a=>{"json"===a.files[0].name.split(".")[1]?(document.getElementById("input").disabled=!1,document.getElementById("label").innerText=a.files[0].name):(document.getElementById("input").disabled=!0,document.getElementById("label").innerText="Choisissez une histoire")};