"use strict";var func=function(e){var a=e.split(" ");a.map(function(e,t){var n=e.toString().slice(1,-1);if(null===document.getElementById(n))return null;a.splice(t,1),elementHandler(document.getElementById(n),a)})},elementHandler=function(e){switch(e.tagName){case"INPUT":e.focus(),e.className="form-control is-invalid";break;case"BUTTON":e.click();break;case"TEXTAREA":e.focus()}};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var stepsList=[];function update(e){if(null==e)var o={};else{if("object"===_typeof(e))o=e;else o=JSON.parse(e);var l=o.steps;document.getElementById("script_name").value=o.script_name,document.getElementById("summary").textContent=o.summary;var c=document.getElementById("step_list");Object.keys(l).forEach(function(e){stepsList.push(e);var t=document.createElement("tr");t.setAttribute("name",e);var n=document.createElement("td");n.innerHTML=e,t.appendChild(n),c.appendChild(t);var a=document.getElementById("first_step"),d=document.createElement("option");d.value=e,d.innerHTML=e,a.appendChild(d);var s=document.createElement("div");s.style.display="flex",t.appendChild(s);var m=document.createElement("button");m.setAttribute("id",e),m.innerHTML="Modifier",m.className="btn btn-info",m.style.margin="0.5em",m.setAttribute("type","button"),m.setAttribute("data-toggle","modal"),m.setAttribute("data-target","#exampleModal"),s.appendChild(m),m.addEventListener("click",function(){return modifyButton(l[e],e)});var u=document.createElement("button");u.setAttribute("id",e),u.innerHTML="Supprimer",u.className="btn btn-danger",u.style.margin="0.5em",s.appendChild(u),u.addEventListener("click",function(){return deleteBtn(l[e],e)}),document.getElementById("submit").addEventListener("click",function(){return handleSubmit(l,o)})})}}function deleteBtn(e,t){var n=t;delete e[n];var a=document.getElementsByName(n)[0];a.parentNode.removeChild(a)}function modifyButton(e,t){var n=t,a=e;console.log(e),document.getElementById("step_name").value=n,document.getElementById("question").textContent=a.question,document.getElementById("answer1").textContent=a.answers[0].answer,a.answers[0].return_message&&(document.getElementById("return_message1").textContent=a.answers[0].return_message),a.answers[0].actions.forEach(function(e){"add_points"==e.action?document.getElementById("addpoints1").checked=!0:"endgame"==e.action?(document.getElementById("endgame1").checked=!0,e.value&&(document.getElementById("endgame_value1").textContent=e.value)):"rankup"==e.action&&(document.getElementById("rankup1").checked=!0,"gold"==e.value?document.getElementById("rankup_select1").getElementsByTagName("option")[0].selected=!0:"silver"==e.value?document.getElementById("rankup_select1").getElementsByTagName("option")[1].selected=!0:document.getElementById("rankup_select1").getElementsByTagName("option")[2].selected=!0,e.hasOwnProperty("message")&&(document.getElementById("rankup_value1").textContent=e.message))}),a.answers[0].next_step&&(document.getElementById("next_step1").value=a.answers[0].next_step),document.getElementById("answer2").textContent=a.answers[1].answer,a.answers[1].return_message&&(document.getElementById("return_message2").textContent=a.answers[1].return_message),a.answers[1].actions.forEach(function(e){"add_points"==e.action?document.getElementById("addpoints2").checked=!0:"endgame"==e.action?(document.getElementById("endgame2").checked=!0,e.value&&(document.getElementById("endgame_value2").textContent=e.value)):"rankup"==e.action&&(document.getElementById("rankup2").checked=!0,"gold"==e.value||e.value,document.getElementById("rankup_select2").getElementsByTagName("option")[1].selected=!0,e.hasOwnProperty("message")&&(document.getElementById("rankup_value2").textContent=e.message))}),a.answers[1].next_step&&(document.getElementById("next_step2").value=a.answers[1].next_step)}function modify(e){document.querySelectorAll("#step_list > tr").forEach(function(e){console.log(e)});var t=document.getElementById("step_name").value,n=document.getElementById("question").value,a=document.getElementById("answer1").value,d=document.getElementById("return_message1").value;""==d&&(d="null");var s=document.getElementById("next_step1").value;""==s&&(s="null");var m=[];if(document.getElementById("rankup1").checked){var u=document.getElementById("rankup_value1").value,o={action:"rankup",value:(g=document.getElementById("rankup_select1")).options[g.selectedIndex].value,message:u};m.push(o)}var l=[];if(document.getElementById("endgame1").checked){var c={action:"end_game",value:document.getElementById("endgame_value1").value};m.push(c)}document.getElementById("addpoints1").checked&&m.push({action:"addpoints",value:"1"});var r=document.getElementById("answer2").value,i=document.getElementById("return_message2").value;""==i&&(i="s");var p=document.getElementById("next_step2").value;if(""==p&&(p="null"),document.getElementById("rankup2").checked){var g,y=document.getElementById("rankup_value2").value;o={action:"rankup",value:(g=document.getElementById("rankup_select2")).options[g.selectedIndex].value,message:y};l.push(rankup2)}if(document.getElementById("endgame2").checked){var v={action:"end_game",value:document.getElementById("endgame_value2").value};l.push(v)}document.getElementById("addpoints2").checked&&l.push({action:"addpoints",value:"1"}),0===m.length&&m.push({action:"addpoints",value:"1"}),0===l.length&&l.push({action:"addpoints",value:"1"});var E={question:n,answers:[a={answer:a,return_message:d,actions:m,next_step:s},r={answer:r,return_message:i,actions:l,next_step:p}],options:{}};t in steps||addStep(t),steps[t]=E,document.getElementsByClassName("step_form")[0].reset()}function handleSubmit(e,t){var n=document.getElementById("script_name").value,a=document.getElementById("summary").value,d=document.getElementById("first_step"),s=d.options[d.selectedIndex].text,m=document.getElementById("pack"),u=m.options[m.selectedIndex].id,o=document.getElementById("character_id");t={script_name:n,summary:a,version:1,script_background:"blabla.jpg",initial_step:s,character_id:o.options[o.selectedIndex].id,pack:u,steps:e};var l=document.createElement("form");l.setAttribute("method","post"),l.setAttribute("action","validate.php");var c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","json"),c.setAttribute("value",""),c.value=JSON.stringify(t),l.appendChild(c),document.getElementsByTagName("body")[0].appendChild(l),l.submit()}document.getElementsByClassName("step_form")[0].addEventListener("submit",modify);var updateButton=document.getElementById("add_step_btn");function addStep(e){var t=document.getElementById("step_list"),n=document.createElement("tr");n.setAttribute("name",e);var a=document.createElement("td");a.innerHTML=e,n.appendChild(a),t.appendChild(n);var d=document.getElementById("first_step"),s=document.createElement("option");s.value=e,s.innerHTML=e,d.appendChild(s);var m=document.createElement("button");m.setAttribute("id",e),m.innerHTML="Modifier",m.className="btn btn-info",m.style="margin: 0.5em",m.type="button",m.dataset.toggle="modal",m.dataset.target="#exampleModal",n.appendChild(m),m.addEventListener("click",function(){return modifyButton(steps[e],e)});var u=document.createElement("button");u.setAttribute("id",e),u.innerHTML="Supprimer",u.style="margin: 0.5em",u.type="button",u.className="btn btn-danger",n.appendChild(u),u.addEventListener("click",function(){return deleteBtn(steps[e],e)})}function saveDraft(){}function watch(e){"json"===e.files[0].name.split(".")[1]?(document.getElementById("input").disabled=!1,document.getElementById("label").innerText=e.files[0].name):(document.getElementById("input").disabled=!0,document.getElementById("label").innerText="Choisissez une histoire")}