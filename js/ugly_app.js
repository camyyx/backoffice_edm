"use strict";var func=function(e){var a=e.split(" ");a.map(function(e,t){var n=e.toString().slice(1,-1);if(null===document.getElementById(n))return null;a.splice(t,1),elementHandler(document.getElementById(n),a)})},elementHandler=function(e){switch(e.tagName){case"INPUT":e.focus(),e.className="form-control is-invalid";break;case"BUTTON":e.click();break;case"TEXTAREA":e.focus()}};function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var stepsList=[];function update(e){if(null==e)var t={},n={};else{if(console.log(_typeof(t)),"object"===_typeof(e))t=e;else{console.log(_typeof(e));t=JSON.parse(e)}console.log(t);n=t.steps;document.getElementById("script_name").value=t.script_name,document.getElementById("summary").textContent=t.summary;var o=document.getElementById("step_list");Object.keys(n).forEach(function(e){stepsList.push(e);var t=document.createElement("tr");t.setAttribute("name",e);var n=document.createElement("td");n.innerHTML=e,t.appendChild(n),o.appendChild(t);var a=document.getElementById("first_step"),d=document.createElement("option");d.value=e,d.innerHTML=e,a.appendChild(d);var s=document.createElement("button");s.setAttribute("id",e),s.innerHTML="Modifier",s.className="btn btn-info",s.style.margin="0.5em",s.setAttribute("type","button"),s.setAttribute("data-toggle","modal"),s.setAttribute("data-target","#exampleModal"),t.appendChild(s),s.addEventListener("click",modifyButton);var m=document.createElement("button");m.setAttribute("id",e),m.innerHTML="Supprimer",m.className="btn btn-danger",m.style.margin="0.5em",t.appendChild(m),m.addEventListener("click",deleteBtn)})}}function deleteBtn(){var e=this.id;delete steps[e];var t=document.getElementsByName(e)[0];t.parentNode.removeChild(t)}function modifyButton(){var e=this.id,t=steps[e];document.getElementById("step_name").value=e,document.getElementById("question").textContent=t.question,document.getElementById("answer1").textContent=t.answers[0].answer,t.answers[0].return_message&&(document.getElementById("return_message1").textContent=t.answers[0].return_message),t.answers[0].actions.forEach(function(e){"add_points"==e.action?document.getElementById("addpoints1").checked=!0:"endgame"==e.action?(document.getElementById("endgame1").checked=!0,e.value&&(document.getElementById("endgame_value1").textContent=e.value)):"rankup"==e.action&&(document.getElementById("rankup1").checked=!0,"gold"==e.value?document.getElementById("rankup_select1").getElementsByTagName("option")[0].selected=!0:"silver"==e.value?document.getElementById("rankup_select1").getElementsByTagName("option")[1].selected=!0:document.getElementById("rankup_select1").getElementsByTagName("option")[2].selected=!0,e.hasOwnProperty("message")&&(document.getElementById("rankup_value1").textContent=e.message))}),t.answers[0].next_step&&(document.getElementById("next_step1").value=t.answers[0].next_step),document.getElementById("answer2").textContent=t.answers[1].answer,t.answers[1].return_message&&(document.getElementById("return_message2").textContent=t.answers[1].return_message),t.answers[1].actions.forEach(function(e){"add_points"==e.action?document.getElementById("addpoints2").checked=!0:"endgame"==e.action?(document.getElementById("endgame2").checked=!0,e.value&&(document.getElementById("endgame_value2").textContent=e.value)):"rankup"==e.action&&(document.getElementById("rankup2").checked=!0,"gold"==e.value||e.value,document.getElementById("rankup_select2").getElementsByTagName("option")[1].selected=!0,e.hasOwnProperty("message")&&(document.getElementById("rankup_value2").textContent=e.message))}),t.answers[1].next_step&&(document.getElementById("next_step2").value=t.answers[1].next_step)}function modify(e){document.querySelectorAll("#step_list > tr").forEach(function(e){console.log(e)});var t=document.getElementById("step_name").value,n=document.getElementById("question").value,a=document.getElementById("answer1").value,d=document.getElementById("return_message1").value;""==d&&(d="null");var s=document.getElementById("next_step1").value;""==s&&(s="null");var m=[];if(document.getElementById("rankup1").checked){var o=document.getElementById("rankup_value1").value,l={action:"rankup",value:(g=document.getElementById("rankup_select1")).options[g.selectedIndex].value,message:o};m.push(l)}var u=[];if(document.getElementById("endgame1").checked){var c={action:"end_game",value:document.getElementById("endgame_value1").value};m.push(c)}document.getElementById("addpoints1").checked&&m.push({action:"addpoints",value:"1"});var r=document.getElementById("answer2").value,i=document.getElementById("return_message2").value;""==i&&(i="s");var p=document.getElementById("next_step2").value;if(""==p&&(p="null"),document.getElementById("rankup2").checked){var g,y=document.getElementById("rankup_value2").value;l={action:"rankup",value:(g=document.getElementById("rankup_select2")).options[g.selectedIndex].value,message:y};u.push(rankup2)}if(document.getElementById("endgame2").checked){var v={action:"end_game",value:document.getElementById("endgame_value2").value};u.push(v)}document.getElementById("addpoints2").checked&&u.push({action:"addpoints",value:"1"}),0===m.length&&m.push({action:"addpoints",value:"1"}),0===u.length&&u.push({action:"addpoints",value:"1"});var E={question:n,answers:[a={answer:a,return_message:d,actions:m,next_step:s},r={answer:r,return_message:i,actions:u,next_step:p}],options:{}};t in steps||addStep(t),steps[t]=E,document.getElementsByClassName("step_form")[0].reset()}function handleSubmit(e){e.preventDefault();var t=document.getElementById("script_name").value,n=document.getElementById("summary").value,a=document.getElementById("first_step"),d=a.options[a.selectedIndex].text,s=document.getElementById("pack"),m=s.options[s.selectedIndex].id,o=document.getElementById("character_id"),l=o.options[o.selectedIndex].id;json={script_name:t,summary:n,version:1,script_background:"blabla.jpg",initial_step:d,character_id:l,pack:m,steps:steps};var u=document.createElement("form");u.setAttribute("method","post"),u.setAttribute("action","validate.php");var c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","json"),c.setAttribute("value",""),c.value=JSON.stringify(json),u.appendChild(c),document.getElementsByTagName("body")[0].appendChild(u),u.submit()}document.getElementsByClassName("step_form")[0].addEventListener("submit",modify),document.getElementById("submit").addEventListener("click",handleSubmit);var updateButton=document.getElementById("add_step_btn");function addStep(e){var t=document.getElementById("step_list"),n=document.createElement("tr");n.setAttribute("name",e);var a=document.createElement("td");a.innerHTML=e,n.appendChild(a),t.appendChild(n);var d=document.getElementById("first_step"),s=document.createElement("option");s.value=e,s.innerHTML=e,d.appendChild(s);var m=document.createElement("button");m.setAttribute("id",e),m.innerHTML="Modifier",m.className="btn btn-info",m.style="margin: 0.5em",m.type="button",m.dataset.toggle="modal",m.dataset.target="#exampleModal",n.appendChild(m),m.addEventListener("click",modifyButton);var o=document.createElement("button");o.setAttribute("id",e),o.innerHTML="Supprimer",o.style="margin: 0.5em",o.type="button",o.className="btn btn-danger",n.appendChild(o),o.addEventListener("click",deleteBtn)}function saveDraft(){}function watch(e){"json"===e.files[0].name.split(".")[1]?(document.getElementById("input").disabled=!1,document.getElementById("label").innerText=e.files[0].name):(document.getElementById("input").disabled=!0,document.getElementById("label").innerText="Choisissez une histoire")}